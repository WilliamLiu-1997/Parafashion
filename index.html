<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Parafashion</title>
    <link rel="shortcut icon" href="images/parafashion.ico" />
    <link
      rel="stylesheet"
      href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css"
    />
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
  </head>

  <style>
    ::-webkit-scrollbar {
      width: 2px;
      height: 5px;
      background-color: #f5f5f5;
    }

    ::-webkit-scrollbar-track {
      -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);
      border-radius: 10px;
      background-color: #555;
    }

    ::-webkit-scrollbar-thumb {
      border-radius: 10px;
      -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);
      background-color: #f5f5f5;
    }

    body {
      background-color: #000;
      color: #fff;
      margin: 0px;
      overflow: hidden;
      scrollbar-width: none;
      cursor: auto;
    }

    #logo {
      display: none;
      position: absolute;
      background-color: #000;
      background: url(images/logo.png) center center;
      background-size: contain;
      background-repeat: no-repeat;
      width: 80vw;
      height: 80vh;
      left: 10vw;
      top: 10vh;
      z-index: 102;
    }
    #logo_back {
      position: absolute;
      background-color: #000;
      width: 100vw;
      height: 100vh;
      z-index: 102;
    }

    #info {
      position: absolute;
      font-size: 16px;
      font-weight: 100;
      font-family: Lato, sans-serif;
      left: 50%;
      top: 10px;
      text-align: center;
      user-select: none;
      z-index: 100;
      text-transform: uppercase;
      transform: translate(-50%, 0);
    }

    #transform {
      display: none;
      position: absolute;
      background-color: rgba(0, 0, 0, 0);
      left: 50%;
      top: 40px;
      z-index: 9;
      transform: translate(-50%, 0);
    }

    #vertice_num {
      position: absolute;
      font-size: 12px;
      font-weight: 100;
      color: #a0a0a0;
      text-align: center;
      left: 50%;
      bottom: 0px;
      font-family: Lato, sans-serif;
      text-align: center;
      user-select: none;
      text-transform: uppercase;
      transform: translate(-50%, 0);
    }

    canvas {
      width: 100%;
      height: 100%;
    }

    div.panel_box {
      position: absolute;
      box-shadow: 0 0 2px 1px rgba(255, 255, 255, 0.5);
      top: 10%;
      width: 22%;
      min-width: 240px;
      z-index: 10;
      text-align: center;
      cursor: auto;
      display: none;
    }

    .btn:active.focus,
    .btn:active:focus,
    .btn:focus {
      outline: 0px auto -webkit-focus-ring-color;
      outline-offset: 0px;
    }

    .btn-group > .btn:first-child:not(:last-child):not(.dropdown-toggle) {
      border-top-left-radius: 0;
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
      border-bottom-left-radius: 0;
    }
    .btn-group > .btn:last-child:not(:first-child),
    .btn-group > .dropdown-toggle:not(:first-child) {
      border-top-left-radius: 0;
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
      border-bottom-left-radius: 0;
    }

    #gui_container {
      position: absolute;
      max-height: 80%;
      top: 10%;
      right: 0px;
      z-index: 3;
      user-select: none;
      display: none;
    }

    .alert_container {
      position: absolute;
      top: 36px;
      left: 50%;
      transform: translate(-50%, 0);
      z-index: 101;
    }

    .loading {
      display: none;
      position: absolute;
      top: 45%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 99;
      color: white;
      font-size: 40px;
      font-weight: 100;
      font-family: Lato, sans-serif;
      letter-spacing: 10px;
      text-transform: uppercase;
      cursor: wait;
    }
    .loading span {
      animation: shrink 2s infinite;
    }

    @keyframes shrink {
      50% {
        transform: scale(0.3);
      }
    }

    .processing {
      display: none;
      position: absolute;
      top: 45%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 99;
      color: white;
      font-size: 40px;
      font-weight: 100;
      font-family: Lato, sans-serif;
      letter-spacing: 10px;
      text-transform: uppercase;
      cursor: wait;
    }
    .processing span {
      animation: shrink1 5s infinite;
    }

    @keyframes shrink1 {
      3.33% {
        transform: rotate(-25deg);
      }
      6.66% {
        transform: rotate(15deg);
      }
      10% {
        transform: rotate(0deg);
      }
    }

    .tip {
      font-size: 12px;
      font-weight: bold;
      text-align: center;
      color: rgb(228, 228, 228);
    }

    #small_info {
      position: absolute;
      font-family: Lato, sans-serif;
      width: 100%;
      font-size: 12px;
      text-align: center;
      top: calc(45% + 40px);
      color: rgba(255, 255, 255, 0.75);
    }

    .up-area {
      border: 1px dashed rgb(150, 150, 150);
      width: 100%;
      min-height: 50px;
      line-height: 50px;
      background-color: rgba(90, 90, 90, 0);
    }

    img {
      max-width: 100%;
      display: inline-block;
    }

    #texture_container {
      display: none;
      float: right;
    }

    #gui_container_gui {
      overflow-y: scroll;
      overflow-x: hidden;
    }

    #loading_background {
      position: absolute;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 98;
      height: 100%;
      width: 100%;
      cursor: auto;
    }

    .dragObj {
      z-index: 101;
      height: 240px;
      width: 800px;
      position: absolute;
      border-radius: 5px;
      top: calc(45% - 120px);
      left: calc(50% - 400px);
      text-align: center;
      font-family: sans-serif;
      font-weight: bold;
      color: #000000dd;
      background-color: rgb(255, 255, 255);
      box-shadow: 0 0 10px 1px rgba(255, 255, 255, 0.79);
      transition: transform 0.3s, box-shadow 0.5s;
    }
    .dragObj:hover {
      box-shadow: 0 0 20px 1px rgb(255, 255, 255);
      transform: scale(1.05, 1.05);
    }
    .dragObj:active {
      box-shadow: 0 0 8px 1.5px rgb(255, 255, 255);
      transform: scale(0.98, 0.98);
    }
    #dragObjInfo {
      font-size: 32px;
      user-select: none;
    }
    .startbtn {
      z-index: 101;
      height: 48px;
      width: 600px;
      font-size: 32px;
      padding-top: 3px;
      border-radius: 5px;
      position: absolute;
      color: #ffffffdd;
      position: absolute;
      user-select: none;
      text-align: center;
      top: calc(45% + 180px);
      left: calc(50% - 300px);
      box-shadow: 0 0 5px 1.5px rgba(255, 255, 255, 0.79);
      transition: font-size 0.2s, color 0.3s, transform 0.3s, box-shadow 0.3s;
      -webkit-transition: font-size 0.2s, color 0.3s, -webkit-transform 0.3s,
        box-shadow 0.3s;
    }
    .startbtn:hover {
      transform: scale(1.025, 1.025);
      box-shadow: 0 0 7px 1px rgb(255, 255, 255);
      color: #eeeeeedd;
    }
    .startbtn:active {
      transform: scale(0.985, 0.985);
      box-shadow: 0 0 3px 1.5px rgb(255, 255, 255);
      color: #ffffffee;
    }
    .homebtn {
      display: none;
      background-color: rgba(0, 0, 0, 0.75);
      z-index: 101;
      height: 21px;
      width: 100px;
      font-size: 12px;
      padding-top: 2px;
      border-radius: 5px;
      position: absolute;
      color: #ffffffdd;
      position: absolute;
      user-select: none;
      text-align: center;
      top: 10px;
      left: 10px;
      box-shadow: 0 0 5px 1.5px rgba(255, 255, 255, 0.79);
      transition: font-size 0.2s, color 0.2s, transform 0.2s, box-shadow 0.2s;
      -webkit-transition: font-size 0.2s, color 0.2s, -webkit-transform 0.2s,
        box-shadow 0.2s;
    }
    .savebtn {
      display: none;
      background-color: rgba(0, 0, 0, 0.75);
      z-index: 2;
      height: 21px;
      width: 100px;
      font-size: 12px;
      padding-top: 2px;
      border-radius: 5px;
      position: absolute;
      color: #ffffffdd;
      position: absolute;
      user-select: none;
      text-align: center;
      top: 10px;
      right: 10px;
      box-shadow: 0 0 5px 1.5px rgba(255, 255, 255, 0.79);
      transition: font-size 0.2s, color 0.2s, transform 0.2s, box-shadow 0.2s;
      -webkit-transition: font-size 0.2s, color 0.2s, -webkit-transform 0.2s,
        box-shadow 0.2s;
    }
    .exportbtn {
      background-color: rgba(0, 0, 0, 0.75);
      z-index: 2;
      height: 21px;
      width: 33.33%;
      font-size: 12px;
      padding-top: 2px;
      position: absolute;
      color: #ffffffdd;
      position: absolute;
      user-select: none;
      text-align: center;
      bottom: 0px;
      left: 0px;
      box-shadow: 0 0 1px 1px rgba(100, 100, 100, 0.79);
      transition: font-size 0.2s, color 0.2s, transform 0.2s, box-shadow 0.2s;
      -webkit-transition: font-size 0.2s, color 0.2s, -webkit-transform 0.2s,
        box-shadow 0.2s;
    }
    .homebtn:hover,
    .savebtn:hover {
      box-shadow: 0 0 7px 2px rgb(255, 255, 255);
      color: #eeeeeedd;
    }
    .exportbtn:hover {
      box-shadow: 0 0 5px 1px rgba(200, 200, 200, 0.79);
    }
    .homebtn:active,
    .savebtn:active {
      box-shadow: 0 0 3px 1.5px rgb(255, 255, 255);
      color: #ffffffee;
    }
    .exportbtn:active {
      box-shadow: 0 0 2px 1px rgba(200, 200, 200, 0.79);
    }

    @media screen and (max-width: 850px) {
      .dragObj {
        width: 600px;
        left: calc(50% - 300px);
      }
      .startbtn {
        width: 500px;
        left: calc(50% - 250px);
      }
      #dragObjInfo {
        font-size: 24px;
      }
    }
  </style>

  <body>
    <div id="logo_back"><div id="logo"></div></div>
    <div class="homebtn">HOME</div>
    <div class="savebtn">SAVE</div>
    <div class="dragObj" ondragstart="return false;">
      <img
        id="uploadImg"
        src="./images/upload.png"
        alt="/"
        style="
          background-color: rgba(255, 255, 255, 0);
          margin: auto;
          user-select: none;
        "
        height="77%"
        oncontextmenu="return false;"
        ondragstart="return false;"
      />
      <div id="dragObjInfo">Drag or Click to Upload an OBJ/JSON File</div>
      <input
        type="file"
        style="display: none"
        id="objDrag"
        name="objDragselect"
      />
    </div>
    <div class="startbtn">OPEN WITH DEFAULT OBJ</div>
    <div id="loading_background">
      <div id="small_info">
        This may take around 0s(0s) to process the model.
      </div>
    </div>
    <div id="loading" class="loading">
      <span style="animation-delay: 0s">p</span
      ><span style="animation-delay: 0.1s">r</span
      ><span style="animation-delay: 0.2s">o</span
      ><span style="animation-delay: 0.3s">c</span
      ><span style="animation-delay: 0.4s">e</span
      ><span style="animation-delay: 0.5s">s</span
      ><span style="animation-delay: 0.6s">s</span
      ><span style="animation-delay: 0.7s">i</span
      ><span style="animation-delay: 0.8s">n</span
      ><span style="animation-delay: 0.9s">g</span>
    </div>
    <div id="processing" class="processing">
      <span style="animation-delay: 0s">P</span>
      <span style="animation-delay: 0.5s">R</span>
      <span style="animation-delay: 1s">O</span>
      <span style="animation-delay: 1.5s">C</span>
      <span style="animation-delay: 2s">E</span>
      <span style="animation-delay: 2.5s">S</span>
      <span style="animation-delay: 3s">S</span>
      <span style="animation-delay: 3.5s">I</span>
      <span style="animation-delay: 4s">N</span>
      <span style="animation-delay: 4.5s">G</span>
    </div>
    <div id="container"></div>
    <div id="gui_container">
      <button
        type="button"
        class="btn-default"
        data-toggle="collapse"
        data-target="#gui_container_gui"
        style="
          background-color: rgb(45, 45, 45);
          border: 1px solid rgb(90, 90, 90);
          border-style: none none solid none;
          font-size: 12px;
          color: #fff;
          padding: 3px;
          width: 100%;
          min-width: 100px;
        "
      >
        Controls
      </button>
      <div id="gui_container_gui" class="panel-collapse collapse in">
        <div id="texture_container">
          <button
            type="button"
            id="CustomTexture"
            class="btn-default"
            style="
              background-color: rgb(10, 10, 10);
              border: 1px solid rgb(90, 90, 90);
              border-style: none none solid none;
              color: #eee;
              font: 11px 'Lucida Grande', sans-serif;
              padding: 3px;
              width: 100%;
              min-width: 100px;
              text-align: left;
            "
            onclick="customtextureToggle()"
          ></button>
          <div class="dragFile">
            <div class="up-area">
              <div class="tip">Click or Drag to upload a texture...</div>
              <input
                type="file"
                style="display: none"
                id="fileDrag"
                name="fileDragselect"
                multiple
              />
              <div class="list-drag" style="text-align: center"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="alert_uv" class="alert_container"></div>
    <div id="alert_size" class="alert_container"></div>
    <div id="alert_img" class="alert_container"></div>
    <div id="alert_cut" class="alert_container"></div>
    <div id="alert_line" class="alert_container"></div>
    <div id="alert_transmission" class="alert_container"></div>
    <div id="panel_box" class="panel_box">
      <div id="patch_btn" class="btn-group" style="width: 100%">
        <button
          id="hide-patches"
          type="button"
          class="btn"
          style="
            background-color: rgb(45, 45, 45);
            border-right: 1px solid rgb(90, 90, 90);
            font-size: 12px;
            color: #fff;
            padding: 2px;
            width: 90%;
          "
          onclick="hidePatches()"
        >
          Hide Patches
        </button>
        <button
          id="scale-patches"
          type="button"
          class="btn"
          style="
            background-color: rgb(45, 45, 45);
            border-left: 1px solid rgb(90, 90, 90);
            font-size: 12px;
            color: #fff;
            padding: 2px;
            width: 10%;
          "
          onclick="scalePatches()"
        >
          >
        </button>
      </div>
      <div
        id="panel-patches"
        class="collapse in"
        style="background-color: rgba(0, 0, 0, 0.75)"
      >
        <div class="exportbtn" id="exportPNG" style="width: 100%; bottom: 42px">
          Export Patches(PNG)
        </div>
        <div class="exportbtn" id="exportOBJ" style="width: 100%; bottom: 21px">
          Export Patches(OBJ)
        </div>
        <div class="exportbtn" id="exportPLY" style="width: 100%">
          Export Patches Stress(PLY)
        </div>
        <div id="container_patch"></div>
      </div>
    </div>
    <div id="info">
      <p>Parafashion</p>
    </div>
    <div id="transform"></div>
    <div id="vertice_num"></div>
    <script>
      function getQueryVariable(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i = 0; i < vars.length; i++) {
          var pair = vars[i].split("=");
          if (pair[0] == variable) {
            return pair[1];
          }
        }
        return false;
      }

      if (
        getQueryVariable("go") &&
        Math.abs(
          Math.floor(Date.now() / 1000) -
            parseInt(getQueryVariable("go").split("e")[1])
        ) < 60
      ) {
        $("#logo").hide();
        $("#logo_back").hide();
        $(".dragObj").hide();
        $(".startbtn").hide();
        $("#loading").hide();
        $("#processing").hide();
        $("#small_info").hide();
        $(".dragObj").fadeIn(1000);
        $(".startbtn").fadeIn(1000, () => {
          $("#small_info").show();
          show_loading();
        });
      } else {
        $("#logo").fadeIn(2000, () => {
          setTimeout(() => {
            $("#logo").fadeOut(2000, () => {
              $("#logo_back").fadeOut(1000);
            });
          }, 1000);
        });
      }
      $("#CustomTexture").text("⏷ Custom Texture (map)");
      var render_patch_flag = true;
      var patch_scaled = false;
      var resize_patch = false;
      function show_loading() {
        render_patch_flag = false;
        $("#loading").show();
        $("#processing").hide();
        $("#loading").css({ display: "flex", opacity: 0 });
        $("#loading").animate({ opacity: 1 }, 500);
        $("#loading_background").show();
        $(".panel_box").fadeOut();
        $("#gui_container").fadeOut();
        $(".savebtn").fadeOut();
      }
      function show_processing() {
        render_patch_flag = false;
        $("#loading").hide();
        $("#processing").show();
        $("#processing").css({ display: "flex", opacity: 0 });
        $("#processing").animate({ opacity: 1 }, 500);
        $("#loading_background").show();
        $(".panel_box").fadeOut();
        $("#gui_container").fadeOut();
        $(".savebtn").fadeOut();
      }
      function hide_loading() {
        if ($("#hide-patches").text() != "Show Patches") {
          render_patch_flag = true;
        }
        $("#loading").fadeOut(800);
        $("#processing").fadeOut(800);
        $("#loading_background").fadeOut(800);
        $(".panel_box").fadeIn();
        $("#gui_container").fadeIn();
        $(".savebtn").fadeIn();
      }
      function customtextureToggle() {
        $(".up-area").toggle();
        if ($("#CustomTexture").text().substr(0, 1) != "⏵") {
          $("#CustomTexture").text("⏵" + $("#CustomTexture").text().substr(1));
        } else {
          $("#CustomTexture").text("⏷" + $("#CustomTexture").text().substr(1));
        }
      }
      function hidePatches() {
        if (resize_patch) return;
        resize_patch = true;
        if ($("#hide-patches").text() == "Show Patches") {
          $("#panel-patches").collapse("show");
          $("#hide-patches").text("Hide Patches");
          $("#scale-patches").css({ color: "#fff" });
          $(".panel_box").animate(
            { width: "22%", minWidth: "240px" },
            350,
            function () {
              setTimeout(function () {
                resize_patch = false;
              }, 100);
            }
          );

          $("#exportPNG").css({ width: "100%", bottom: "42px" });
          $("#exportOBJ").css({ width: "100%", left: "0%", bottom: "21px" });
          $("#exportPLY").css({ width: "100%", left: "0%" });
          $(".exportbtn").fadeIn(175);
          $("#scale-patches").text(">");
          render_patch_flag = true;
          patch_scaled = false;
        } else {
          $("#panel-patches").collapse("hide");
          $("#hide-patches").text("Show Patches");
          $("#scale-patches").css({ color: "#aaa" });
          $(".panel_box").animate(
            { width: "5%", minWidth: "120px" },
            350,
            function () {
              setTimeout(function () {
                resize_patch = false;
              }, 100);
            }
          );
          $(".exportbtn").fadeOut(175);
          $("#scale-patches").text(">");
          render_patch_flag = false;
          patch_scaled = false;
        }
      }
      function scalePatches() {
        if (
          $("#hide-patches").text() != "Show Patches" &&
          $("#scale-patches").text() != "<"
        ) {
          resize_patch = true;
          $(".exportbtn").fadeOut(175, () => {
            $("#exportPNG").css({ width: "30%", bottom: "0px" });
            $("#exportOBJ").css({
              width: "30%",
              left: "30%",
              bottom: "0px",
            });
            $("#exportPLY").css({ width: "40%", left: "60%" });
            $(".exportbtn").fadeIn(175);
          });
          $(".panel_box").animate(
            {
              width: Math.max(
                window.innerWidth * 0.2,
                window.innerWidth - 2 - $("#gui_container").width()
              ),
            },
            350,
            function () {
              setTimeout(function () {
                resize_patch = false;
              }, 100);
              patch_scaled = true;
            }
          );
          $("#scale-patches").text("<");
        } else if (
          $("#hide-patches").text() != "Show Patches" &&
          $("#scale-patches").text() == "<"
        ) {
          resize_patch = true;
          $(".exportbtn").fadeOut(175, () => {
            $("#exportPNG").css({ width: "100%", bottom: "42px" });
            $("#exportOBJ").css({ width: "100%", left: "0%", bottom: "21px" });
            $("#exportPLY").css({ width: "100%", left: "0%" });
            $(".exportbtn").fadeIn(175);
          });
          $(".panel_box").animate({ width: "22%" }, 350, function () {
            setTimeout(function () {
              resize_patch = false;
            }, 100);
          });
          $("#scale-patches").text(">");
          patch_scaled = false;
        }
      }
    </script>
    <script src="js/FileSaver.js"></script>
    <script type="module" src="scenes.js"></script>
  </body>
</html>
